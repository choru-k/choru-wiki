---
tags:
  - Saga Pattern
  - Distributed Transactions
  - Business Case
  - E-commerce
  - Guide
---

# 16.4a Saga ν¨ν„΄ - μ‹¤μ „ λΉ„μ¦λ‹μ¤ μ‚¬λ΅€μ™€ λ¬Έμ  μ •μ

## π― 2023λ…„ 4μ›” - μ „μμƒκ±°λ μ£Όλ¬Έ μ²λ¦¬μ μ•…λ½κ³Ό κµ¬μ›

μ κ°€ λ€ν• μ „μμƒκ±°λ ν”λ«νΌμ μ‹λ‹μ–΄ μ•„ν‚¤ν…νΈλ΅ μΌν•  λ• κ²μ—λ κ°€μ¥ λ³µμ΅ν• λ„μ „ μ¤‘ ν•λ‚μ€μµλ‹λ‹¤. λ§μ΄ν¬λ΅μ„λΉ„μ¤ ν™κ²½μ—μ„ μ£Όλ¬Έ μ²λ¦¬ κ³Όμ •μ λ¶„μ‚° νΈλμ­μ… λ¬Έμ λ¥Ό Saga ν¨ν„΄μΌλ΅ ν•΄κ²°ν• μ‹¤μ  κ²½ν—μ„ κ³µμ ν•©λ‹λ‹¤.

### π’¥ λ¶„μ‚° νΈλμ­μ…μ μ§€μ¥

**2023λ…„ 4μ›” 3μΌ - λ°μ΄ν„° λ¶μΌμΉμ μ°Έμ‚¬**

```bash
π° μ°λ¦¬κ°€ λ§μ£Όν• λ”μ°ν• ν„μ‹¤:

π“ μ‹μ¤ν… ν„ν™© (λ§μ΄ν¬λ΅μ„λΉ„μ¤ ν™κ²½):
- μ£Όλ¬Έ μ„λΉ„μ¤ (Order Service)
- μ¬κ³  μ„λΉ„μ¤ (Inventory Service)  
- κ²°μ  μ„λΉ„μ¤ (Payment Service)
- λ°°μ†΅ μ„λΉ„μ¤ (Shipping Service)
- ν¬μΈνΈ μ„λΉ„μ¤ (Point Service)
- μ•λ¦Ό μ„λΉ„μ¤ (Notification Service)

π’¥ λ°μƒν•λ” λ¬Έμ λ“¤:
- κ²°μ λ” μ„±κ³µν–λ”λ° μ¬κ³ κ°€ μ°¨κ°λμ§€ μ•μ
- ν¬μΈνΈλ” μ°¨κ°λλ”λ° μ£Όλ¬Έμ΄ μ‹¤ν¨ν•¨
- λ°°μ†΅μ€ μ‹μ‘λλ”λ° κ²°μ κ°€ μ·¨μ†λ¨
- μΌκ΄€μ„± μ—†λ” λ°μ΄ν„°λ΅ μΈν• κ³ κ° λ¶λ§ ν­μ¦

# κΈ°μ΅΄μ λ¶„μ‚° νΈλμ­μ… μ‹λ„λ“¤
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚            μ‹¤ν¨ν• μ ‘κ·Όλ²•λ“¤                          β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ 1. 2PC (Two-Phase Commit)                      β”‚
β”‚    β†’ κ°€μ©μ„± λ¬Έμ , λ‹¨μΌ μ¥μ• μ                       β”‚
β”‚                                                 β”‚
β”‚ 2. λ¶„μ‚° λ½ (Distributed Lock)                   β”‚
β”‚    β†’ λ°λ“λ½, μ„±λ¥ μ €ν•                           β”‚
β”‚                                                 β”‚  
β”‚ 3. λ³΄μƒ νΈλμ­μ… μλ™ μ²λ¦¬                         β”‚
β”‚    β†’ ν΄λ¨Ό μ—λ¬, λ³µκµ¬ λ¶κ°€λ¥                       β”‚
β”‚                                                 β”‚
β”‚ 4. κ²°κ³Όμ  μΌκ΄€μ„± λ¬΄μ‹                            β”‚
β”‚    β†’ λ°μ΄ν„° λ¶μΌμΉ, λΉ„μ¦λ‹μ¤ λ΅μ§ κΉ¨μ§             β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

π“ λΉ„μ¦λ‹μ¤ μ„ν©νΈ:
- μ£Όλ¬Έ μ‹¤ν¨μ¨: 15% (κ³ κ° μ΄νƒ μ›μΈ)
- λ°μ΄ν„° λ¶μΌμΉ: μΌμΌ ν‰κ·  500κ±΄
- μλ™ λ³΄μƒ μ‘μ—…: κ°λ°μ μΌμΌ 4μ‹κ°„ ν¬μ…
- κ³ κ° λ¬Έμ: μΌμΌ 1,200κ±΄ (λ°μ΄ν„° λ¶μΌμΉ κ΄€λ ¨)
- λ§¤μ¶ μ†μ‹¤: μ›” μ•½ 5μ–µμ› (μ£Όλ¬Έ μ‹¤ν¨/μ·¨μ†λ΅ μΈν•)
```

### π€ Saga ν¨ν„΄ λ„μ… - λ¶„μ‚° νΈλμ­μ…μ νλ…

**μ£Όλ¬Έ μ²λ¦¬ Saga μ„¤κ³„**

```mermaid
sequenceDiagram
    participant Client
    participant OrderService
    participant InventoryService
    participant PaymentService
    participant ShippingService
    participant PointService
    participant NotificationService
    
    Client->>OrderService: μ£Όλ¬Έ μ”μ²­
    OrderService->>OrderService: μ£Όλ¬Έ μƒμ„±
    OrderService-->>Client: μ£Όλ¬Έ ID λ°ν™
    
    Note over OrderService,NotificationService: Saga μ‹μ‘ (λΉ„λ™κΈ°)
    
    OrderService->>InventoryService: μ¬κ³  μμ•½
    InventoryService->>InventoryService: μ¬κ³  ν™•μΈ & μμ•½
    InventoryService-->>OrderService: μ¬κ³  μμ•½ μ™„λ£
    
    OrderService->>PaymentService: κ²°μ  μ²λ¦¬
    PaymentService->>PaymentService: κ²°μ  μ‹¤ν–‰
    PaymentService-->>OrderService: κ²°μ  μ™„λ£
    
    OrderService->>PointService: ν¬μΈνΈ μ°¨κ°
    PointService->>PointService: ν¬μΈνΈ μ²λ¦¬
    PointService-->>OrderService: ν¬μΈνΈ μ°¨κ° μ™„λ£
    
    OrderService->>ShippingService: λ°°μ†΅ μ”μ²­
    ShippingService->>ShippingService: λ°°μ†΅ μ¤€λΉ„
    ShippingService-->>OrderService: λ°°μ†΅ μ ‘μ μ™„λ£
    
    OrderService->>NotificationService: μ£Όλ¬Έ μ™„λ£ μ•λ¦Ό
    NotificationService-->>OrderService: μ•λ¦Ό λ°μ†΅ μ™„λ£
    
    Note over OrderService: Saga μ„±κ³µ μ™„λ£
    
    rect rgb(255, 200, 200)
        Note over OrderService,NotificationService: μ‹¤ν¨ μ‹ λ³΄μƒ νΈλμ­μ…
        OrderService->>ShippingService: λ°°μ†΅ μ·¨μ†
        OrderService->>PointService: ν¬μΈνΈ λ³µμ›
        OrderService->>PaymentService: κ²°μ  μ·¨μ†
        OrderService->>InventoryService: μ¬κ³  ν•΄μ 
        OrderService->>OrderService: μ£Όλ¬Έ μ·¨μ†
    end
```

### π‰ 6κ°μ›” ν›„μ λ†€λΌμ΄ κ²°κ³Ό

**2023λ…„ 10μ›” 15μΌ - μ™„μ „ν λ‹¬λΌμ§„ μ‹μ¤ν…**

```bash
β… μ„±κ³Ό μ§€ν‘:

π€ μ•μ •μ„± ν–¥μƒ:
- μ£Όλ¬Έ μ‹¤ν¨μ¨: 15% β†’ 0.3% (50λ°° κ°μ„ !)
- λ°μ΄ν„° λ¶μΌμΉ: 500κ±΄/μΌ β†’ 5κ±΄/μΌ (100λ°° κ°μ†)
- μλ™ κ°μ…: 4μ‹κ°„/μΌ β†’ 10λ¶„/μΌ (κ±°μ μλ™ν™”)
- λ³µκµ¬ μ‹κ°„: ν‰κ·  4μ‹κ°„ β†’ ν‰κ·  30μ΄

π“ λΉ„μ¦λ‹μ¤ μ„ν©νΈ:
- κ³ κ° λ§μ΅±λ„: 3.2/5.0 β†’ 4.7/5.0
- μ£Όλ¬Έ μ™„λ£μ¨: 85% β†’ 99.7%
- κ³ κ°μ„Όν„° λ¬Έμ: 1,200κ±΄/μΌ β†’ 150κ±΄/μΌ
- λ§¤μ¶ μ¦λ€: μ›” 15μ–µμ› (μ‹¤ν¨ μ£Όλ¬Έ λ³µκµ¬λ΅ μΈν•)

π”„ μ΄μ ν¨μ¨μ„±:
- μλ™ λ³µκµ¬: 99.5% (μλ™ κ°μ… κ±°μ λ¶ν•„μ”)
- λ¨λ‹ν„°λ§: μ‹¤μ‹κ°„ Saga μƒνƒ μ¶”μ  κ°€λ¥
- λ””λ²„κΉ…: μ „μ²΄ νΈλμ­μ… νλ¦„ μ™„λ²½ μ¶”μ 
- ν™•μ¥μ„±: μƒλ΅μ΄ μ„λΉ„μ¤ μ¶”κ°€ μ‹ Sagaλ§ ν™•μ¥

# Saga ν¨ν„΄ μ μ© μ „ν›„ λΉ„κµ (μ£Όλ¬Έ μ²λ¦¬ κΈ°μ¤€)
κΈ°μ΅΄:
β κ²°μ  μ™„λ£ β†’ μ¬κ³  μ‹¤ν¨ β†’ μλ™ ν™λ¶ μ²λ¦¬ (4μ‹κ°„ μ†μ”)

Saga μ μ© ν›„:
β… κ²°μ  μ™„λ£ β†’ μ¬κ³  μ‹¤ν¨ β†’ μλ™ κ²°μ  μ·¨μ† (30μ΄ μ™„λ£)
```

## ν•µμ‹¬ μ”μ 

### 1. μ‹¤μ  λΉ„μ¦λ‹μ¤ λ¬Έμ μ μ‹¬κ°μ„±

- λ§μ΄ν¬λ΅μ„λΉ„μ¤μ—μ„ λ¶„μ‚° νΈλμ­μ…μ€ ν•„μ—°μ  λ¬Έμ 
- λ°μ΄ν„° λ¶μΌμΉκ°€ λΉ„μ¦λ‹μ¤μ— λ―ΈμΉλ” μ§μ ‘μ  μ†μ‹¤
- μλ™ λ³µκµ¬ μ‘μ—…μ ν•κ³„μ™€ μ„ν—μ„±

### 2. Saga ν¨ν„΄μ νμ‹ μ  ν•΄κ²°μ±…

- μλ™ν™”λ λ³΄μƒ νΈλμ­μ…μΌλ΅ μ™„λ²½ν• λ³µκµ¬
- μ‹μ¤ν… κ°€μ©μ„±κ³Ό ν™•μ¥μ„± λ™μ‹ ν™•λ³΄
- μ‹¤μ‹κ°„ λ¨λ‹ν„°λ§μ„ ν†µν• μ΄μ ν¬λ…μ„±

### 3. μΈ΅μ • κ°€λ¥ν• λΉ„μ¦λ‹μ¤ κ°€μΉ

- 99% μ΄μƒμ μ£Όλ¬Έ μ„±κ³µλ¥  λ‹¬μ„±
- μ΄μ λΉ„μ© λ€ν­ μ κ°
- κ³ κ° λ§μ΅±λ„ ν„μ €ν• κ°μ„ 

---

**λ‹¤μ**: [16.4b Saga ν¨ν„΄ ν•µμ‹¬ κ°λ…κ³Ό μ¤μΌ€μ¤νΈλ μ΄μ…](04b-saga-orchestration.md)μ—μ„ Saga ν¨ν„΄μ μ΄λ΅ μ  λ°°κ²½κ³Ό Java κΈ°λ° μ¤μΌ€μ¤νΈλ μ΄μ… κµ¬ν„μ„ ν•™μµν•©λ‹λ‹¤.

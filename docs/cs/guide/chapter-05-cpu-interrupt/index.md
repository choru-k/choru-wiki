---
tags:
  - CPU
  - Interrupt
  - SystemCall
  - Guide
  - Kernel
  - SystemProgramming
---

# Chapter 5: CPUμ™€ μΈν„°λ½νΈ - μ‹μ¤ν…μ μ‹¬μ¥λ°•λ™

## μ΄ μ¥μ—μ„ λ‹¤λ£¨λ” λ‚΄μ©

λ‹Ήμ‹ μ΄ μ§€κΈ μ΄ κΈ€μ„ μ½λ” λ™μ•, CPUλ” μ΄λ‹Ή μλ°±λ§ λ² User modeμ™€ Kernel modeλ¥Ό μ¤κ°€λ©°, μμ² κ°μ μΈν„°λ½νΈλ¥Ό μ²λ¦¬ν•κ³ , μμ‹­ κ°μ ν”„λ΅μ„Έμ¤λ¥Ό μ¤μΌ€μ¤„λ§ν•©λ‹λ‹¤.

λ§μ°μ¤λ¥Ό μ›€μ§μ΄λ©΄ μΈν„°λ½νΈκ°€ λ°μƒν•κ³ , ν‚¤λ³΄λ“λ¥Ό λ„λ¥΄λ©΄ λ μΈν„°λ½νΈκ°€ λ°μƒν•©λ‹λ‹¤. λ„¤νΈμ›ν¬ ν¨ν‚·μ΄ λ„μ°©ν•΄λ„, λ””μ¤ν¬ I/Oκ°€ μ™„λ£λμ–΄λ„ μΈν„°λ½νΈμ…λ‹λ‹¤.

μ΄ μ¥μ—μ„λ” ν„λ€ μ»΄ν“¨ν„°μ μ‹¬μ¥λ°•λ™μΈ CPU μ•„ν‚¤ν…μ²μ™€ μΈν„°λ½νΈ μ‹μ¤ν…μ„ κΉμ΄ μκ² νƒκµ¬ν•©λ‹λ‹¤. CPUκ°€ μ–΄λ–»κ² μλ§μ€ μ‘μ—…μ„ ν¨μ¨μ μΌλ΅ μ²λ¦¬ν•λ”μ§€, μΈν„°λ½νΈκ°€ μ–΄λ–»κ² μ‹μ¤ν…μ λ°μ‘μ„±μ„ λ†’μ΄λ”μ§€, κ·Έλ¦¬κ³  μ „λ ¥ κ΄€λ¦¬λ” μ–΄λ–»κ² μ΄λ£¨μ–΄μ§€λ”μ§€ μ•μ•„λ΄…λ‹λ‹¤.

## μ™ μ΄κ²ƒμ„ μ•μ•„μ•Ό ν•λ”κ°€?

### μ‹¤λ¬΄μ—μ„ λ§μ£ΌμΉλ” CPU/μΈν„°λ½νΈ λ¬Έμ λ“¤

λ‹¤μκ³Ό κ°™μ€ μƒν™©μ„ κ²½ν—ν•΄λ³΄μ…¨λ‚μ”?

- β΅ **λ†’μ€ CPU μ‚¬μ©λ¥ **: 100% CPUμΈλ° μ‹¤μ  μ‘μ—…μ€ μ—†λ” μƒν™©
- π”¥ **Soft Lockup**: μ‹μ¤ν…μ΄ λ©μ¶ κ²ƒμ²λΌ λ³΄μ΄λ” ν„μƒ
- π― **μΈν„°λ½νΈ μ¤ν†°**: κ³Όλ„ν• μΈν„°λ½νΈλ΅ μ‹μ¤ν… λ§λΉ„
- β° **λ μ΄ν„΄μ‹ λ¬Έμ **: μ‹¤μ‹κ°„ μ²λ¦¬κ°€ ν•„μ”ν•λ° μ§€μ—° λ°μƒ
- π”‹ **μ „λ ¥ μ†λ¨**: λ°°ν„°λ¦¬κ°€ λΉ¨λ¦¬ λ‹³κ±°λ‚ λ°μ—΄ λ¬Έμ 

μ΄λ° λ¬Έμ λ“¤μ κ·Όλ³Έ μ›μΈμ€ CPUμ™€ μΈν„°λ½νΈ μ‹μ¤ν…μ— λ€ν• μ΄ν•΄ λ¶€μ΅±μ…λ‹λ‹¤. μ΄ μ¥μ„ λ§μ¤ν„°ν•λ©΄, μ‹μ¤ν… λ λ²¨μ—μ„ μ„±λ¥μ„ μµμ ν™”ν•κ³  λ¬Έμ λ¥Ό μ§„λ‹¨ν•  μ μμµλ‹λ‹¤.

## CPUμ™€ μΈν„°λ½νΈ μ•„ν‚¤ν…μ² ν•λμ— λ³΄κΈ°

```mermaid
graph TB
    subgraph "CPU Core"
        REG[λ μ§€μ¤ν„°]
        ALU[ALU]
        CU[Control Unit]
        CACHE[L1/L2 Cache]
    end
    
    subgraph "Execution Modes"
        USER[User Mode<br/>Ring 3]
        KERNEL[Kernel Mode<br/>Ring 0]
    end
    
    subgraph "Interrupt System"
        HW[Hardware Interrupt]
        SW[Software Interrupt<br/>System Call]
        EX[Exception]
        
        IDT[IDT<br/>Interrupt Descriptor Table]
        ISR[ISR<br/>Interrupt Service Routine]
    end
    
    subgraph "Power Management"
        CSTATE[C-States<br/>Idle States]
        PSTATE[P-States<br/>Performance States]
        FREQ[CPU Frequency]
    end
    
    USER -->|System Call| KERNEL
    HW --> IDT
    SW --> IDT
    EX --> IDT
    IDT --> ISR
    ISR --> KERNEL
    
    style REG fill:#FFE082
    style IDT fill:#81C784
    style KERNEL fill:#64B5F6
```

## μ΄ μ¥μ κµ¬μ„±

### [5-1: CPU μ•„ν‚¤ν…μ²μ™€ μ‹¤ν–‰](01-cpu-architecture.md)

**"CPUμ λ‚΄λ¶€ κµ¬μ΅°μ™€ λ…λ Ήμ–΄ μ‹¤ν–‰ κ³Όμ •"**

- π—οΈ **CPU κµ¬μ΅°**: λ μ§€μ¤ν„°, ALU, μ μ–΄ μ λ‹›μ μ—­ν• 
- π”„ **νμ΄ν”„λΌμ΄λ‹**: λ…λ Ήμ–΄ λ³‘λ ¬ μ²λ¦¬ κΈ°λ²•
- π’Ύ **μΊμ‹ κ³„μΈµ**: L1/L2/L3 μΊμ‹μ™€ μ„±λ¥
- π― **λ¶„κΈ° μμΈ΅**: CPUκ°€ λ―Έλλ¥Ό μμΈ΅ν•λ” λ°©λ²•

### [5-2: μΈν„°λ½νΈμ™€ μμ™Έ](02-interrupt-exception.md)

**"μ‹μ¤ν…μ μ΄λ²¤νΈ μ²λ¦¬ λ©”μ»¤λ‹μ¦"**

- π“΅ **μΈν„°λ½νΈ μΆ…λ¥**: ν•λ“μ›¨μ–΄/μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ
- β οΈ **μμ™Έ μ²λ¦¬**: Fault, Trap, Abortμ μ°¨μ΄
- π”§ **IDTμ™€ ISR**: μΈν„°λ½νΈ μ²λ¦¬ κ³Όμ •
- π“ **μΈν„°λ½νΈ λ°Έλ°μ‹±**: IRQ μ–΄ν”Όλ‹ν‹°μ™€ μ„±λ¥

### [5-3: μ»¨ν…μ¤νΈ μ¤μ„μΉ­](03-context-switching.md)

**"μ‘μ—… μ „ν™μ λΉ„μ©κ³Ό μµμ ν™”"**

- π”„ **μ»¨ν…μ¤νΈ μ¤μ„μΉ­ κ³Όμ •**: λ μ§€μ¤ν„° μ €μ¥κ³Ό λ³µμ›
- π’° **μ¤μ„μΉ­ λΉ„μ©**: μΊμ‹ λ¬΄ν¨ν™”μ™€ TLB ν”λ¬μ‹
- β΅ **μµμ ν™” κΈ°λ²•**: μ¤μ„μΉ­ λΉλ„ μ¤„μ΄κΈ°
- π― **CPU μ–΄ν”Όλ‹ν‹°**: μΊμ‹ μΉν™”μ  μ¤μΌ€μ¤„λ§

### [5-4: μ „λ ¥ κ΄€λ¦¬](04-power-management.md)

**"μ„±λ¥κ³Ό ν¨μ¨μ κ· ν•"**

- π”‹ **C-States**: CPU μ ν΄ μƒνƒ κ΄€λ¦¬
- β΅ **P-States**: λ™μ  μ£Όνμ μ΅°μ •
- π΅οΈ **μ—΄ κ΄€λ¦¬**: Thermal Throttling
- π® **μ„±λ¥ κ±°λ²„λ„**: μ „λ ¥ μ •μ±… μ„¤μ •

## μ‹¤μµ ν™κ²½ μ¤€λΉ„

μ΄ μ¥μ μμ λ“¤μ„ μ§μ ‘ μ‹¤ν–‰ν•΄λ³΄λ ¤λ©΄ λ‹¤μ λ„κµ¬λ“¤μ΄ ν•„μ”ν•©λ‹λ‹¤:

```bash
# CPU μ •λ³΄ ν™•μΈ
$ lscpu                      # CPU μ•„ν‚¤ν…μ² μ •λ³΄
$ cat /proc/cpuinfo         # μƒμ„Έ CPU μ •λ³΄
$ cpupower frequency-info   # μ£Όνμ μ •λ³΄

# μΈν„°λ½νΈ λ¨λ‹ν„°λ§
$ cat /proc/interrupts      # μΈν„°λ½νΈ ν†µκ³„
$ watch -n 1 'cat /proc/interrupts | grep -E "CPU|timer"'
$ mpstat -P ALL 1          # CPUλ³„ μΈν„°λ½νΈ ν™•μΈ

# μ„±λ¥ λ¶„μ„
$ perf stat -e cycles,instructions,cache-misses
$ perf record -e cpu-cycles -g
$ turbostat                # μ „λ ¥ μƒνƒ λ¨λ‹ν„°λ§

# μ»¨ν…μ¤νΈ μ¤μ„μΉ­
$ vmstat 1                  # cs μ»¬λΌ ν™•μΈ
$ pidstat -w 1             # ν”„λ΅μ„Έμ¤λ³„ μ¤μ„μΉ­
```

## μ΄ μ¥μ„ μ½κ³  λ‚λ©΄

β… **CPU μ΄ν•΄**: ν„λ€ CPUμ λ‚΄λ¶€ λ™μ‘ μ›λ¦¬ μ™„λ²½ μ΄ν•΄  
β… **μΈν„°λ½νΈ λ§μ¤ν„°**: μΈν„°λ½νΈ μ²λ¦¬μ™€ μµμ ν™” λ¥λ ¥  
β… **μ„±λ¥ μ§„λ‹¨**: CPU λ³‘λ© ν„μƒ λ¶„μ„κ³Ό ν•΄κ²°  
β… **μ „λ ¥ μµμ ν™”**: μ„±λ¥κ³Ό μ „λ ¥ μ†λΉ„μ κ· ν• μ΅°μ •  
β… **μ‹μ¤ν… νλ‹**: μ›ν¬λ΅λ“μ— λ§λ” CPU μ„¤μ • μµμ ν™”  

## ν•µμ‹¬ κ°λ… λ―Έλ¦¬λ³΄κΈ°

```mermaid
mindmap
  root((CPUμ™€ μΈν„°λ½νΈ))
    CPU μ•„ν‚¤ν…μ²
      νμ΄ν”„λΌμΈ
        Fetch
        Decode
        Execute
        Memory
        Write-back
      μΊμ‹
        L1 (I-Cache/D-Cache)
        L2 (Unified)
        L3 (Shared)
        μΊμ‹ μΌκ΄€μ„±
      μ‹¤ν–‰ λ¨λ“
        User Mode (Ring 3)
        Kernel Mode (Ring 0)
        λ¨λ“ μ „ν™
    μΈν„°λ½νΈ
      ν•λ“μ›¨μ–΄
        νƒ€μ΄λ¨Έ
        ν‚¤λ³΄λ“/λ§μ°μ¤
        λ„¤νΈμ›ν¬
        λ””μ¤ν¬
      μ†ν”„νΈμ›¨μ–΄
        System Call
        μ‹κ·Έλ„
      μμ™Έ
        Page Fault
        Division by Zero
        Invalid Opcode
    μ»¨ν…μ¤νΈ μ¤μ„μΉ­
      λ μ§€μ¤ν„° μ €μ¥
        λ²”μ© λ μ§€μ¤ν„°
        ν”„λ΅κ·Έλ¨ μΉ΄μ΄ν„°
        μ¤νƒ ν¬μΈν„°
      μƒνƒ λ³µμ›
        ν”„λ΅μ„Έμ¤ μƒνƒ
        λ©”λ¨λ¦¬ λ§µ
        νμΌ λ””μ¤ν¬λ¦½ν„°
      μµμ ν™”
        CPU μ–΄ν”Όλ‹ν‹°
        μΊμ‹ μ›λ°
    μ „λ ¥ κ΄€λ¦¬
      C-States
        C0 (Active)
        C1 (Halt)
        C2-C10 (Deep Sleep)
      P-States
        Turbo Boost
        μ£Όνμ μ¤μΌ€μΌλ§
      κ±°λ²„λ„
        Performance
        Powersave
        Ondemand
```

## CPU λ¬Έμ  μ§„λ‹¨ ν”λ΅μ°μ°¨νΈ

```mermaid
graph TD
    Start[CPU λ¬Έμ  λ°μƒ] --> Type{λ¬Έμ  μ ν•?}
    
    Type -->|λ†’μ€ μ‚¬μ©λ¥ | Usage[CPU μ‚¬μ©λ¥  λ¶„μ„]
    Usage --> TopProcess[top/htopμΌλ΅ ν”„λ΅μ„Έμ¤ ν™•μΈ]
    TopProcess --> Optimize[μ½”λ“ μµμ ν™” λλ” μ¤μΌ€μΌλ§]
    
    Type -->|μΈν„°λ½νΈ κ³Όλ‹¤| Interrupt[μΈν„°λ½νΈ λ¶„μ„]
    Interrupt --> IRQBalance[IRQ λ°Έλ°μ‹± ν™•μΈ]
    IRQBalance --> Affinity[CPU μ–΄ν”Όλ‹ν‹° μ΅°μ •]
    
    Type -->|λ μ΄ν„΄μ‹| Latency[λ μ΄ν„΄μ‹ μ›μΈ λ¶„μ„]
    Latency --> CSwitch[μ»¨ν…μ¤νΈ μ¤μ„μΉ­ ν™•μΈ]
    CSwitch --> Isolate[CPU Isolation μ μ©]
    
    Type -->|μ „λ ¥/λ°μ—΄| Power[μ „λ ¥ μƒνƒ ν™•μΈ]
    Power --> Governor[κ±°λ²„λ„ μ„¤μ • μ΅°μ •]
    Governor --> Cooling[μΏ¨λ§ μ†”λ£¨μ… κ°μ„ ]
```

## λ‹¤μ λ‹¨κ³„

μ΄μ  [5-1: CPU μ•„ν‚¤ν…μ²μ™€ μ‹¤ν–‰](01-cpu-architecture.md)λ¶€ν„° μ‹μ‘ν•μ—¬, CPUμ λ‚΄λ¶€ κµ¬μ΅°μ™€ λ…λ Ήμ–΄ μ‹¤ν–‰ κ³Όμ •μ„ κΉμ΄ μκ² νƒκµ¬ν•΄λ΄…μ‹λ‹¤.

CPUμ™€ μΈν„°λ½νΈλ” μ»΄ν“¨ν„° μ‹μ¤ν…μ μ‹¬μ¥κ³Ό μ‹ κ²½κ³„μ…λ‹λ‹¤. μ΄λ“¤μ΄ μ–΄λ–»κ² ν‘λ ¥ν•μ—¬ λ³µμ΅ν• μ‘μ—…μ„ μ²λ¦¬ν•λ”μ§€ μ΄ν•΄ν•λ©΄, μ§„μ •ν• μ‹μ¤ν… μ—”μ§€λ‹μ–΄λ΅ κ±°λ“­λ‚  μ μμµλ‹λ‹¤.